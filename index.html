<!DOCTYPE html>
<html>
<head>
	<script src="https://code.jquery.com/jquery-2.1.4.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>

	<!-- Google Map Api -->
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD0VpncNMqoubUsS8ed6qNNVYPfg8ZWDuI&libraries=visualization,places&region=HK">
	</script>

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

	<!-- firebase -->
	<script src="https://www.gstatic.com/firebasejs/4.0.0/firebase.js"></script>
	<script>
	  // Initialize Firebase
	  var config = {
	  	apiKey: "AIzaSyDSQMvii71BdGgTI3MjstW74e_aG1rW6m4",
	  	authDomain: "rehab-sharedroute.firebaseapp.com",
	  	databaseURL: "https://rehab-sharedroute.firebaseio.com",
	  	projectId: "rehab-sharedroute",
	  	storageBucket: "rehab-sharedroute.appspot.com",
	  	messagingSenderId: "80612275505"
	  };
	  firebase.initializeApp(config);
	</script>

	<script src="app.js"></script>
	<link rel="stylesheet" href="app.css">
</head>
<body ng-app="app" ng-controller="AppController" ng-init="init()">
	<div id="panel">
		<div id="title">
			行程編號: {{data.routeId}}, 共用路線: {{data.customers.length}}
			<!-- Button trigger modal -->
			<!-- 
				<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#routesControlModal">
				
				</button>
			-->
		</div>

		<!-- Nav tabs -->
		<ul class="nav nav-tabs" role="tablist">
			<li role="presentation" class="active"><a href="#searchboxes" aria-controls="searchboxes" role="tab" data-toggle="tab">設定行程</a></li>
			<li role="presentation"><a href="#routes" aria-controls="routes" role="tab" data-toggle="tab">收費詳情</a></li>
		</ul>

		<!-- Tab panes -->
		<div class="tab-content">
			<div role="tabpanel" class="tab-pane active" id="searchboxes">
				<!-- stop list -->
				<div class="searchbox-container" ng-repeat="(stop_no, stop) in data.stops">
					<!-- stop info -->
					<div ng-if="!stop.isEditing">
						<div class="searchbox-handle">
							<div class="handle">
								{{stop_no+1}}
							</div>
						</div>
						<div class="searchbox">
							<div>{{stop.formatted_address}}, {{stop.name}}
								<span class="searchbox-menu">
									<button class="btn btn-primary" ng-click="editStop(stop, stop_no)"> Ed </button>
								</span>
							</div>
							<div class="list-group">
								<div ng-if="(data.customers | filter: {pick:stop_no}).length"> 上車: 
									<span ng-repeat="customer in data.customers | filter: {pick:stop_no}"> 
										{{customer.name}}
									</span>
								</div>
								<div ng-if="(data.customers | filter: {drop:stop_no}).length"> 下車: 
									<span ng-repeat="customer in data.customers | filter: {drop:stop_no}">
										{{customer.name}}(預算*:${{customer.totalFee.toFixed(2)}})
									</span>
								</div>
							</div>
						</div>
					</div>
					<!-- stop info edit -->
					<div ng-if="stop.isEditing">
						<div class="searchbox-handle">
							<div class="handle">
								<button class="btn btn-primary" ng-click="removeStop(stop)"> X </button> {{stop_no+1}}
							</div>
						</div>
						<div class="searchbox">
							<input type="text" autocomplete-input stop="stop" ng-model="stop._input_address">
							<span class="searchbox-menu">
								<button class="btn btn-primary" ng-click="editStop(stop, stop_no)"> OK </button>
							</span>
							<div class="list-group">
								<div class="list-group-item" ng-repeat="customer in data.customers" ng-if="customer.pick==stop_no || customer.pick==null" ng-click="customer._pick==stop_no ? customer._pick=null : customer._pick=stop_no;" ng-class="customer._pick==stop_no ? 'active' : '';"> 
									上車: <input type="text" ng-model="customer.name" size="10">
									<button class="btn btn-primary" ng-click="removeCustomer(customer.$$hashKey);"> X </button>
								</div>
								<div class="list-group-item" ng-repeat="customer in data.customers" ng-if="customer.drop==stop_no || (customer.pick !=null && customer.drop==null)" ng-click="customer._drop==stop_no ? customer._drop=null : customer._drop=stop_no;" ng-class="customer._drop==stop_no ? 'active' : '';">
									下車: <input type="text" ng-model="customer.name" size="10">
								</div>
								<button class="list-group-item btn btn-primary" ng-click="addCustomer();">新增乘客</button>
							</div>
							<!-- {{stop}} -->
						</div>
					</div>
				</div>
				<!-- end of stop list -->

				<!-- stop to be added -->
				<div class="searchbox-container">
					<div class="searchbox">
						<table>
							<tr>
								<td>請輸入目的地</td>
								<td><input type="text" autocomplete-input stop="data.new_stop" ng-model="data.new_stop._input_address"></td>
								<td><button class="btn btn-primary" ng-click="addStop()"> + </button></td>
							</tr>
							<tr ng-if="data.new_stop._place">
								<td>選擇上落乘客</td>
								<td>
									<div class="list-group">
										<div class="list-group-item" ng-repeat="customer in data.customers | filter: {pick:null}"  ng-click="customer._pick==data.stops.length?customer._pick=null:customer._pick=data.stops.length;" ng-class="customer._pick==data.stops.length?'active':''"> 
											上車: <input type="text" ng-model="customer.name" size="10">
											<button class="btn btn-primary" ng-click="removeCustomer(customer.$$hashKey);"> X </button>
										</div>
										<div class="list-group-item" ng-repeat="customer in data.customers | filter: {pick:'!!', drop:null}" ng-click="customer._drop==data.stops.length?customer._drop=null:customer._drop=data.stops.length;" ng-class="customer._drop==data.stops.length?'active':''">
											下車: <input type="text" ng-model="customer.name" size="10">
										</div>
										<button class="list-group-item btn btn-primary" ng-click="addCustomer();">新增乘客</button>
									</div>
								</td>
							</tr>
						</table>
					</div>
				</div>
				<!-- end of stop to be added -->
			</div>

			<div role="tabpanel" class="tab-pane" id="routes">
				<table>
					<tr><th>乘客</th><th>行程</th><th>預計收費</th></tr>
					<tr ng-repeat="customer in data.customers">
						<td>{{customer.name}}</td>
						<td> 
							由 {{data.stops[customer.pick].formatted_address}}, {{data.stops[customer.pick].name}} <br> 
							去 {{data.stops[customer.drop].formatted_address}}, {{data.stops[customer.drop].name}} <br> 
							<span ng-if="customer.totalFee">
								預計行程 {{(customer.totalDistance/1000).toFixed(2)}}公里, 時間{{(customer.totalDuration/60).toFixed(2)}}分鐘 
							</span>
						</td>
						<td>
							<span ng-if="customer.totalFee">
								起錶收費: ${{config.initFee.toFixed(2)}} <br>
								路費(每公里${{config.distanceFee}}): ${{customer.distanceFee.toFixed(2)}} <br>
								<span ng-if="customer.durationFee">付加費(如超過1小時): ${{customer.durationFee.toFixed(2)}} <br> </span>
								電召服務費: ${{config.adminFee.toFixed(2)}} <br>
								<span ng-if="data.customers.length > 1">共用車折扣({{config.sharedDiscount*10}}折): -${{customer.sharedDiscount.toFixed(2)}} <br> </span>
								預計收費 ${{customer.totalFee.toFixed(2)}} <br>
								(不包括隧道費)
							</span>
							<span ng-if="!customer.totalFee">
								未有行程
							</span>
						</td>
					</tr>
				</table>
			</div>
		</div>
	</div>

	<!-- Google Map -->
	<div id="map"></div>
	<!-- Google Map -->

	<!-- Modal -->
	<!-- 
	<div class="modal fade" id="routesControlModal" tabindex="-1" role="dialog">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h4 class="modal-title">共用路線數及乘客</h4>
				</div>
				<div class="modal-body">
					<div>
						共用路線數: <input type="text" ng-model="data.routes" ng-change="routesChanged()">
						<button type="button" class="btn btn-primary" ng-click="data.routes=data.routes-1; routesChanged();"> - </button>
						<button type="button" class="btn btn-primary" ng-click="data.routes=data.routes+1; routesChanged();"> + </button>
						(1-9)
					</div>
					<div class="list-group">
						<input type="text" class="list-group-item" ng-repeat="customer in data.customers" ng-model="customer.name">
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-primary" data-dismiss="modal">確定</button>
				</div>
			</div>
		</div>
	</div>
-->
</body>
</html>